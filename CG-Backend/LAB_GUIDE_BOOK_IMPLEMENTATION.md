# Lab Guide Book Implementation
## Date: October 20, 2025, 08:35 UTC

---

## ðŸŽ¯ Overview

Successfully implemented **automated Lab Guide Book generation** for all course projects. The system now generates a comprehensive lab guide book that combines all lab exercises into a single, well-organized document.

---

## âœ¨ What Was Created

### 1. New Lambda Function: LabGuideBuilder

**File:** `/home/juan/AuroraV1/CG-Backend/lambda/lab_guide_builder.py`

**Purpose:** Automatically builds a complete lab guide book by combining all lab exercises from a project.

**Key Features:**
- Auto-discovers lab files from `{project}/labguide/` folder
- Organizes labs by module
- Extracts metadata (duration, complexity, Bloom level)
- Normalizes lab titles (removes "Lab XX-YY-ZZ:" prefixes)
- Generates hierarchical table of contents
- Creates statistics summary
- Outputs both Markdown and JSON formats

### 2. Workflow Integration

**Updated:** Step Functions state machine to automatically invoke LabGuideBuilder after lab generation

**When:** After all labs are generated in "both" mode (theory + labs)

**Flow:**
```
Generate Labs â†’ CombineLabResultsBoth â†’ InvokeLabGuideBuilder â†’ Success
```

---

## ðŸ“Š Lab Guide Book Structure

### Front Matter

```markdown
# {Book Title}

**Author:** Aurora AI  
**Generated by:** Aurora AI Lab Guide Generator  
**Total Lab Exercises:** X  
**Estimated Total Time:** Xh Ymin  
**Publication Date:** {Date}

## About This Lab Guide

[Description of what the lab guide contains]
```

### Table of Contents (Hierarchical)

```markdown
# Table of Contents

## Module 1 Labs
  - Lab 1: Title (duration, complexity)
  - Lab 2: Title (duration, complexity)

## Module 2 Labs
  - Lab 1: Title (duration, complexity)
...
```

### Lab Exercises (Organized by Module)

```markdown
# Module 1 Labs

---

## Lab 1: Title

**Duration:** 35 minutos  
**Complexity:** FÃ¡cil  
**Bloom Level:** Crear  

[Full lab content]

---

## Lab 2: Title

**Duration:** 60 minutos  
**Complexity:** Media  
**Bloom Level:** Aplicar  

[Full lab content]

---
```

### Statistics Summary

```markdown
## Lab Guide Statistics

- **Total Modules with Labs**: X
- **Total Lab Exercises**: Y
- **Total Words**: Z
- **Estimated Total Time**: Xh Ymin
- **Average Words per Lab**: N
- **Generated on**: {timestamp}

## Lab Exercise Summary

| Module | Lab # | Title | Duration | Complexity |
|--------|-------|-------|----------|------------|
| 1 | 1 | ... | 35 min | FÃ¡cil |
...
```

---

## ðŸ”§ Implementation Details

### Lab File Naming Convention

Expected format: `lab-{MM}-{LL}-{NN}-{title}.md`

- **MM**: Module number (01, 02, etc.)
- **LL**: Lesson number (07, 06, etc.)
- **NN**: Lab number within that module (01, 02, etc.)

Examples:
- `lab-01-07-01-prÃ¡ctica-1-crea-agentes.md` â†’ Module 1, Lab 1
- `lab-02-06-01-prÃ¡ctica-3-desplegar-mcp.md` â†’ Module 2, Lab 1

### Metadata Extraction

The system automatically extracts from lab content:

```python
**DuraciÃ³n:** 35 minutos  â†’ duration: "35 minutos"
**Complejidad:** FÃ¡cil    â†’ complexity: "FÃ¡cil"
**Nivel de Bloom:** Crear  â†’ bloom_level: "Crear"
```

### Title Normalization

Removes redundant prefixes from lab titles:

```python
# Before:
"Lab 01-07-01: PrÃ¡ctica 1: Crea agentes..."

# After:
"Crea agentes en el Copilot Studio de Teams"
```

Patterns removed:
- `Lab XX-YY-ZZ:`
- `Lab X:`
- `PrÃ¡ctica X:`

---

## ðŸ“ Files Generated

For each project, the Lab Guide Builder creates:

### 1. Complete Markdown File

**Location:** `s3://{bucket}/{project}/book/{title}_LabGuide_complete.md`

**Example:** `251018-JS-06/book/Microsoft_Copilot_Studio_y_SOC_LabGuide_complete.md`

**Size:** ~45,000 words (varies by project)

**Format:** Complete book with:
- Front matter
- Table of contents
- All lab exercises organized by module
- Statistics summary

### 2. JSON Metadata File

**Location:** `s3://{bucket}/{project}/book/{title}_LabGuide_data.json`

**Example:** `251018-JS-06/book/Microsoft_Copilot_Studio_y_SOC_LabGuide_data.json`

**Structure:**
```json
{
  "metadata": {
    "title": "Book Title",
    "author": "Aurora AI",
    "generated_at": "2025-10-20T20:34:14.346924",
    "total_modules": 7,
    "total_labs": 8,
    "total_words": 45390,
    "estimated_time": "5h 10min (310 min total)",
    "project_folder": "251018-JS-06"
  },
  "modules": [
    {
      "module_number": 1,
      "module_title": "Module 1 Labs",
      "labs": [
        {
          "lab_number": 1,
          "title": "Lab Title",
          "duration": "35 minutos",
          "complexity": "FÃ¡cil",
          "bloom_level": "Crear",
          "word_count": 5234
        }
      ]
    }
  ],
  "s3_key": "...",
  "bucket": "..."
}
```

---

## ðŸŽ¯ Project 251018-JS-06 Lab Guide

### Statistics

- **Total Modules with Labs:** 7
- **Total Lab Exercises:** 8
- **Total Words:** 45,390
- **Estimated Total Time:** 5h 10min (310 min)
- **Average Words per Lab:** 5,674

### Lab Breakdown

| Module | Lab # | Title | Duration | Complexity | Bloom Level |
|--------|-------|-------|----------|------------|-------------|
| 1 | 1 | Crea agentes en Copilot Studio de Teams | 35 min | FÃ¡cil | Crear |
| 1 | 2 | Crea agentes con datos e IA Generativa | 35 min | Media | Crear |
| 2 | 1 | Desplegar MCP local y consultas seguras | 60 min | Media | Crear |
| 3 | 1 | Desplegar LLM Gateway local (proxy) | 60 min | Alta | Crear |
| 4 | 1 | Crear workflow de caza de amenazas en n8n | 60 min | Alta | Crear |
| 5 | 1 | Pipeline RAG: ingestiÃ³n â†’ indexaciÃ³n â†’ consulta | 60 min | Alta | Crear |
| 6 | 1 | SimulaciÃ³n prompt injection y playbook | N/A | Alta | Aplicar |
| 7 | 1 | Ejercicio integrador: MCP + Gateway + n8n + SIEM | N/A | N/A | Evaluar |

**Total:** 310 minutes (5h 10min) of hands-on practice

---

## ðŸš€ Deployment Details

### SAM Template Changes

**Added Resource:** `LabGuideBuilder` Lambda function

```yaml
LabGuideBuilder:
  Type: AWS::Serverless::Function
  Properties:
    Description: Builds complete lab guide books
    Handler: lab_guide_builder.lambda_handler
    Runtime: python3.12
    CodeUri: lambda/
    MemorySize: 512
    Timeout: 300
    Events:
      BuildLabGuideApi:
        Type: Api
        Path: /build-lab-guide
        Method: post
```

**Added to Outputs:**
```yaml
LabGuideBuilderFunction:
  Description: Lab Guide Builder Lambda Function ARN
  Value: !GetAtt LabGuideBuilder.Arn
```

### Step Functions Workflow Update

**Added State:** `InvokeLabGuideBuilder`

**Placement:** After `CombineLabResultsBoth`, before `SuccessState`

```yaml
InvokeLabGuideBuilder:
  Type: Task
  Resource: arn:aws:states:::lambda:invoke
  Parameters:
    FunctionName: !GetAtt LabGuideBuilder.Arn
    Payload:
      course_bucket.$: $.course_bucket
      project_folder.$: $.project_folder
      lab_keys.$: $.all_lab_keys
  ResultPath: $.lab_guide_result
  Next: SuccessState
```

**Benefit:** Automatically builds lab guide book at end of "both" mode executions

---

## ðŸ§ª Testing & Verification

### Manual Test

```bash
aws lambda invoke \
  --function-name crewai-course-generator-stack-LabGuideBuilder-3G4pm9YpQeCp \
  --cli-binary-format raw-in-base64-out \
  --payload '{
    "course_bucket":"crewai-course-artifacts",
    "project_folder":"251018-JS-06",
    "book_title":"Microsoft_Copilot_Studio_y_SOC"
  }' \
  /tmp/lab-guide-build.json
```

### Test Results

âœ… **Success:** Generated lab guide with 8 labs  
âœ… **Duration:** ~3 seconds  
âœ… **Output Files:** Both .md and .json created  
âœ… **Size:** 45,390 words  
âœ… **Structure:** Proper module hierarchy  

### Verification

```bash
# Download and preview
aws s3 cp s3://crewai-course-artifacts/251018-JS-06/book/Microsoft_Copilot_Studio_y_SOC_LabGuide_complete.md ./

# Check structure
head -n 50 Microsoft_Copilot_Studio_y_SOC_LabGuide_complete.md

# Verify TOC shows all modules
grep "^## Module" Microsoft_Copilot_Studio_y_SOC_LabGuide_complete.md
```

---

## ðŸ”„ Workflow Integration

### Before (No Lab Guide Book)

```
Generate Theory â†’ Build Book â†’ Generate Labs â†’ Success
```

**Result:** Labs scattered in `labguide/` folder, no consolidated guide

### After (With Lab Guide Book)

```
Generate Theory â†’ Build Book â†’ Generate Labs â†’ Build Lab Guide â†’ Success
```

**Result:** 
- Theory Book: All lessons in one book
- Lab Guide Book: All labs in one organized guide

---

## ðŸ’¡ Usage

### Automatic (via Workflow)

When running a course generation in **"both"** mode:

1. System generates all lessons
2. BookBuilder creates theory book
3. System generates all labs
4. **LabGuideBuilder creates lab guide book** (NEW!)
5. Success

**No manual action required!**

### Manual (API Call)

```bash
curl -X POST https://your-api.execute-api.us-east-1.amazonaws.com/Prod/build-lab-guide \
  -H "Content-Type: application/json" \
  -d '{
    "course_bucket": "crewai-course-artifacts",
    "project_folder": "251018-JS-06",
    "book_title": "Course_Name"
  }'
```

### Manual (Lambda Direct)

```bash
aws lambda invoke \
  --function-name crewai-course-generator-stack-LabGuideBuilder-{id} \
  --payload '{"course_bucket":"...","project_folder":"..."}' \
  output.json
```

---

## ðŸŽ¨ Customization Options

### Custom Book Title

```json
{
  "course_bucket": "crewai-course-artifacts",
  "project_folder": "251018-JS-06",
  "book_title": "My Custom Lab Guide Title"
}
```

### Custom Author

```json
{
  "author": "Custom Author Name"
}
```

### Specific Labs Only

```json
{
  "lab_keys": [
    "251018-JS-06/labguide/lab-01-07-01-...md",
    "251018-JS-06/labguide/lab-02-06-01-...md"
  ]
}
```

---

## ðŸ“‹ Function Signatures

### Helper Functions

```python
def extract_lab_title(content, filename) -> str:
    """Extract title from lab content or filename"""

def normalize_lab_title(title, lab_num) -> str:
    """Remove 'Lab XX-YY-ZZ:' prefixes"""

def extract_module_lab_numbers(filename) -> tuple:
    """Extract (module_num, lab_num) from filename"""
    # Returns: (1, 1) for lab-01-07-01-...md

def extract_lab_metadata(content) -> dict:
    """Extract duration, complexity, Bloom level"""
    # Returns: {duration, complexity, bloom_level}

def sum_durations(duration_list) -> str:
    """Calculate total estimated time"""
    # Returns: "5h 10min (310 min total)"
```

---

## ðŸŒŸ Benefits

### For Students

1. **Single Document:** All labs in one place
2. **Clear Organization:** Structured by module
3. **Quick Reference:** Table of contents for navigation
4. **Time Planning:** See total time commitment upfront
5. **Difficulty Assessment:** Complexity levels visible

### For Instructors

1. **Course Planning:** See full lab scope
2. **Time Management:** Total duration calculated
3. **Prerequisites:** Clear requirements per lab
4. **Assessment:** Bloom levels documented
5. **Easy Distribution:** Single file to share

### For Operations

1. **Automated:** No manual compilation needed
2. **Consistent:** Same structure every time
3. **Versioned:** Tracked with project
4. **Searchable:** Full-text search capability
5. **Auditable:** Metadata in JSON format

---

## ðŸ”® Future Enhancements

### Potential Improvements

1. **PDF Generation:** Convert Markdown to PDF automatically
2. **Interactive TOC:** Add hyperlinks in Markdown
3. **Lab Dependencies:** Show prerequisite chains
4. **Progress Tracking:** Add checkboxes for completion
5. **Answer Keys:** Optional answer/solution sections
6. **Multi-language:** Support for multiple language versions
7. **Lab Difficulty Scoring:** Automated complexity calculation
8. **Resource Requirements:** List all tools/software needed

### Planned Features

- Integration with Learning Management Systems (LMS)
- Instructor notes section
- Assessment rubrics
- Lab solution files
- Video demo links

---

## ðŸ“– Related Documentation

- **BOOK_HIERARCHY_FIX.md** - Theory book module hierarchy
- **LESSON_TITLE_NORMALIZATION_FIX.md** - Lesson title fixes
- **ARCHITECTURE.md** - Overall system architecture
- **TESTING_GUIDE.md** - How to test the system

---

## âœ… Deployment Summary

**Date:** October 20, 2025, 08:35 UTC  
**Stack:** crewai-course-generator-stack  
**Status:** âœ… **DEPLOYED**  
**Function ARN:** `crewai-course-generator-stack-LabGuideBuilder-3G4pm9YpQeCp`

**Changes Deployed:**
- âœ… New Lambda function: LabGuideBuilder
- âœ… New API endpoint: /build-lab-guide
- âœ… Updated Step Functions workflow
- âœ… New CloudFormation outputs
- âœ… Tested with project 251018-JS-06

**Verification:**
- âœ… Lab guide book generated successfully
- âœ… 8 labs organized into 7 modules
- âœ… 45,390 words total
- âœ… 5h 10min estimated time
- âœ… Proper module hierarchy
- âœ… Clean normalized titles

---

## ðŸŽ‰ Conclusion

The Lab Guide Book feature is **fully implemented and deployed**. All future course generations in "both" mode will automatically create:

1. **Theory Book** - All lessons organized by module
2. **Lab Guide Book** - All lab exercises organized by module (NEW!)

Both books are professionally formatted, well-organized, and ready for distribution to students.

**Status:** âœ… **PRODUCTION READY**

---

**Implementation Complete:** October 20, 2025, 08:35 UTC  
**First Lab Guide Generated:** Project 251018-JS-06  
**Next Steps:** Test with new course generation to verify automatic creation
